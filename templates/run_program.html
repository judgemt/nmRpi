<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Run Program</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>Run Program</h1>
    
    <!-- Load Program Section -->
    <h2>Load Program</h2>
    <form id="loadProgramForm">
        <label for="program_name">Select Program:</label>
        <select id="program_name" name="program_name">
            {% for program in programs %}
                <option value="{{ program }}">{{ program }}</option>
            {% endfor %}
        </select>
        <button type="button" onclick="loadProgram()">Load Program</button>
    </form>
    
    <!-- Display Program Section -->
    <h2>Program Content</h2>
    <pre id="program_content"></pre>
    
    <!-- Run Program Section -->
    <button id="runButton" onclick="startProgram()">Run Program</button>
    <button id="pauseButton" onclick="pauseProgram()" style="display: none;">Pause</button>
    <button id="resumeButton" onclick="resumeProgram()" style="display: none;">Resume</button>
    <button id="stopButton" onclick="stopProgram()" style="display: none;">Stop</button>

    <!-- Log Display Section -->
    <h2>Execution Log</h2>
    <ul id="log">
        {% for entry in log %}
            <li>{{ entry }}</li>
        {% endfor %}
    </ul>

    <script>
        
        $(document).ready(function() {
            console.log("JavaScript is working!");
        });

        function loadProgram() {
            const programName = $("#program_name").val();
            $.post("{{ url_for('load_program') }}", { program_name: programName }, function(data) {
                $("#program_content").text(data.content);
            });
        }

        function startProgram() {
            const content = $("#program_content").text();
            $.post("{{ url_for('start_program') }}", { program_content: content }, function() {
                $("#runButton").hide();
                $("#pauseButton, #stopButton").show();
                updateLog();
            });
        }

        function pauseProgram() {
            $.post("{{ url_for('pause_program') }}", function() {
                $("#pauseButton").hide();
                $("#resumeButton").show();
            });
        }

        function resumeProgram() {
            $.post("{{ url_for('resume_program') }}", function() {
                $("#resumeButton").hide();
                $("#pauseButton").show();
            });
        }

        function stopProgram() {
            $.post("{{ url_for('stop_program') }}", function() {
                $("#pauseButton, #resumeButton, #stopButton").hide();
                $("#runButton").show();
            });
        }

        function updateLog() {
            $.get("{{ url_for('get_log') }}", function(data) {
                const newLog = data.log;
                $("#log").empty(); // Clear the current log
                newLog.forEach(entry => {
                    $("#log").append(`<li>${entry}</li>`); // Append each log entry
                });
            });
        }

        // Call updateLog periodically during program execution
        setInterval(updateLog, 1000); // Update log every second

        function monitorProgramStatus() {
            // Check periodically if the program is still running
            setInterval(() => {
                $.get("{{ url_for('get_log') }}", function(data) {
                    const log = data.log;
                    if (log.includes("Program execution complete.")) {
                        $("#pauseButton, #resumeButton, #stopButton").hide();
                        $("#runButton").show();
                    }
                });
            }, 1000); // Check every second
        }

        // Call monitorProgramStatus when starting the program
        monitorProgramStatus(); 
               
    </script>
</body>
</html>
